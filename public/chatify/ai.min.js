function Y4(J,Z){let Q={};try{Q=JSON.parse(localStorage.getItem("prompts"))||{}}catch(D){alert("Error parsing prompts from localStorage!")}Q[J]=Z,localStorage.setItem("prompts",JSON.stringify(Q))}function a(J=null){let Z={};try{Z=JSON.parse(localStorage.getItem("prompts"))||{}}catch(Q){alert("Error parsing prompts from localStorage!")}if(J===null)return Z;else return Z[J]}function N4(J){let Z={};try{Z=JSON.parse(localStorage.getItem("prompts"))||{}}catch(Q){alert("Error parsing prompts from localStorage!")}delete Z[J],localStorage.setItem("prompts",JSON.stringify(Z))}var Y=new Map;class ${elm;constructor(J){if(J instanceof HTMLElement)this.elm=J;else this.elm=document.createElement(J||"div")}text(J){return this.elm.innerText=J,this}html(J){return this.elm.innerHTML=J,this}cleanup(){return this.elm.remove(),this}query(J){return this.elm.querySelector(J)}qs(J){if(this.elm.querySelector(J))return $.from(this.elm.querySelector(J));else return null}qsa(J){if(this.elm.querySelector(J))return Array.from(this.elm.querySelectorAll(J)).map((Z)=>$.from(Z));else return null}id(J){return this.elm.id=J,this}class(...J){for(let Z=0;Z<J.length;Z++)this.elm.classList.toggle(J[Z]);return this}classOn(...J){for(let Z=0;Z<J.length;Z++)this.elm.classList.add(J[Z]);return this}classOff(...J){for(let Z=0;Z<J.length;Z++)this.elm.classList.remove(J[Z]);return this}style(J){for(let Z of Object.keys(J))this.elm.style.setProperty(Z,J[Z]);return this}styleJs(J){for(let Z of Object.keys(J))this.elm.style[Z]=J[Z];return this}on(J,Z){return this.elm.addEventListener(J,Z),this}un(J,Z){return this.elm.removeEventListener(J,Z),this}appendTo(J){if(J instanceof HTMLElement)J.appendChild(this.elm);else if(J instanceof $)J.elm.appendChild(this.elm);else if(typeof J==="string")document.querySelector(J)?.appendChild(this.elm);return this}append(J){if(J instanceof HTMLElement)this.elm.appendChild(J);else if(J instanceof $)this.elm.appendChild(J.elm);else if(typeof J==="string"){const Z=document.createElement(J);return this.elm.appendChild(Z),new $(Z.tagName)}return this}appendMany(...J){for(let Z of J)this.append(Z);return this}clear(){return this.elm.innerHTML="",this}attr(J){for(let Z in J)if(J[Z]!==null&&J[Z]!==void 0)this.elm.setAttribute(Z,J[Z]);else this.elm.removeAttribute(Z);return this}val(J){var Z=this.elm;return Z.value=J,this}getText(){return this.elm.innerText}getHtml(){return this.elm.innerHTML}getValue(){return this.elm.value}swapRef(J){return this.elm=J,this}static from(J){if(typeof J==="string"){const Z=$.qs(J);if(Z===null)return null;else return Z}else return new $(J)}static qs(J){if(document.querySelector(J))return $.from(document.querySelector(J));else return null}static qsa(J){if(document.querySelector(J))return Array.from(document.querySelectorAll(J)).map((Z)=>$.from(Z));else return null}}class B{constructor(J){if(this.modal=new $("div"),this.modal.class("modal"),this.modal.attr({"aria-modal":"true",role:"dialog"}),this.content=new $("div"),this.content.class("modal-content"),this.content.appendTo(this.modal),typeof J==="string")this.content.html(J);else if(J instanceof HTMLElement)this.content.append(J);else if(J instanceof $)this.content.append(J.elm);this.closeBtn=new $("button"),this.closeBtn.class("close-btn","transparent"),this.closeBtn.text("x"),this.closeBtn.attr({type:"button"}),this.closeBtn.on("click",this.hide.bind(this)),this.closeBtn.appendTo(this.content),this.overlay=new $("div"),this.overlay.class("modal-overlay"),this.overlay.appendTo(this.modal),this.modal.on("keydown",(Q)=>{this.handleKeyDown(Q)});const Z=this.content.elm.querySelectorAll('a[href], button, textarea, input[type="text"], input[type="checkbox"], input[type="radio"], select');this.elementsArray=Array.prototype.slice.call(Z),this.elementsArray.forEach((Q)=>{Q.setAttribute("tabindex","0")}),this.elementsArray[0].addEventListener("keydown",(Q)=>{if(Q.key==="Tab"&&Q.shiftKey)Q.preventDefault(),this.elementsArray[this.elementsArray.length-1].focus()}),this.elementsArray[this.elementsArray.length-1].addEventListener("keydown",(Q)=>{if(Q.key==="Tab"&&!Q.shiftKey)Q.preventDefault(),this.elementsArray[0].focus()}),this.elementsArray[0].focus()}show(){this.modal.appendTo("body"),this.modal.elm.focus(),this.elementsArray[0].focus()}hide(){this.modal.cleanup()}handleKeyDown(J){if(J.key==="Escape")this.hide()}}async function y4(){const J=await fetch("/api/prompts").then((Z)=>Z.json());return window.prompts=JSON.parse(JSON.stringify(J)),J}function t(J,Z){try{const Q=JSON.parse(J);if(Q.system&&Q.temp){if(Q.name===void 0)Q.name=!1;if(Q.avatar===void 0)Q.avatar=!1;Y.get("customSettings_systemPrompt").elm.value=Q.system,Y.get("customSettings_temp").elm.value=Q.temp,Y.set("aiNameOverride",Q.name||""),Y.set("aiAvatarOverride",Q.avatar||""),Y.get("customSettings_overrideName").elm.value=Y.get("aiNameOverride"),Y.get("customSettings_overrideAvatar").elm.value=Y.get("aiAvatarOverride"),Z()}else{Z();const D=new $("div").text('Something may be wrong with the prompt, please make sure it is a valid JSON object with "system" and "temp".');new B(D).show()}}catch(Q){Z(),console.error(Q);const D=new $("div").html("Failed to load prompt. Please make sure it is a valid JSON string!<br>Error code: "+Q);new B(D).show()}}function U4(){window.addEventListener("storage",(J)=>{loadUserSettings(),window.dispatchEvent(new CustomEvent("chatify-settings-update",{detail:{data:J.newValue}}))}),window.addEventListener("chatify-settings-update",function(J){usernameInput.elm.value=userSettings.username,settings_enableUserName.elm.checked=userSettings.includeUsername,settings_rememberContextCheckbox.elm.checked=userSettings.rememberContext,themeSelect.elm.value=userSettings.theme,settings_showAvatarsCheckbox.elm.checked=userSettings.showAvatars,settings_showNamesCheckbox.elm.checked=userSettings.showNames,settings_showCopyBtnCheckbox.elm.checked=userSettings.showCopyButton,settings_showEditButtonCheckbox.elm.checked=userSettings.showEditButton,document.documentElement.dataset.showEditButton=userSettings.showEditButton,chatSelect.elm.value=userSettings.chatViewType,settings_togglePromptPrefixCheckbox.elm.checked=userSettings.promptPrefixEnabled,togglePpReadonly(),promptPrefixBox.elm.value=userSettings.promptPrefix,ctxLength.elm.value=userSettings.ctxLength,maxTokens.elm.value=userSettings.maxTokens,settings_testModeCheckbox.elm.checked=userSettings.testMode}),window.addEventListener("chatify-message-request",async(J)=>{if(J.detail.history&&J.detail.history==="remove")messageHistory=[];await request(J.detail.data,!1)})}async function e(){await fetch("/api/usage").then((J)=>J.json()).then((J)=>{g4=J,Y.set("apiUsage",g4)})}function D4(){const J=Y.get("apiUsage");if(J.remaining!==null)Y.get("requestUi_text").text(`${J.used} of ${J.total} requests used (${J.plan}).`),Y.get("requestUi_meter").attr({value:J.used,max:J.total}),Y.get("requestUi_meter").query("div").style.width=J.used/J.total*100+"%",Y.get("requestUi_meter").classOff("extra-hidden"),Y.get("requestUi_hint").text(`Your quota resets ${futureDate(new Date(J.expires))}.`);else Y.get("requestUi_text").text(`0 of ${J.total} requests used (${J.plan}).`),Y.get("requestUi_meter").classOn("extra-hidden"),Y.get("requestUi_hint").text("")}var g4={used:0,remaining:0,total:0,expires:"",plan:"free"};await e();function J4(J){let Z=!1,Q="";J=J.replace(/&/g,"&amp;"),J=J.replace(/</g,"&lt;"),J=J.replace(/>/g,"&gt;");const D=J.split("\n");for(let K=0;K<D.length;K++){const X=D[K];if(Z)if(X.trim()==="```")Z=!1,Q+="</code></pre>";else Q+=X+"\n";else if(X.trim().startsWith("```")){Z=!0;const z=X.trim().slice(3);Q+=`<pre><code class="language-${z}">`}else Q+=O1(X)+"\n"}if(Z)Q+="</code></pre>";const V=Q.match(/<code.+?class="language-(.*?)".*?>[\s\S]+?<\/code>/gim)||[];for(let K=0;K<V.length;K++){const X=document.createElement("div");X.innerHTML=V[K];const z=X.textContent,O=V[K].match(/class="language-([^"]+)"/i),G=O?O[1]:"plaintext";try{const w=hljs.highlight(z,{language:G}).value;Q=Q.replace(V[K],`<code class="language-${G}">${w}</code>`)}catch(w){}}return Q}function O1(J){return J=J.replace(/^# (.+)/gm,"<h1>$1</h1>"),J=J.replace(/^## (.+)/gm,"<h2>$1</h2>"),J=J.replace(/^### (.+)/gm,"<h3>$1</h3>"),J=J.replace(/^#### (.+)/gm,"<h4>$1</h4>"),J=J.replace(/^##### (.+)/gm,"<h5>$1</h5>"),J=J.replace(/^###### (.+)/gm,"<h6>$1</h6>"),J=J.replace(/\*\*(.+?)\*\*/g,"<strong>$1</strong>"),J=J.replace(/\*(.+?)\*/g,"<em>$1</em>"),J=J.replace(/\[(.+?)\]\((.+?)\)/g,'<a href="$2">$1</a>'),J=J.replace(/!\[(.+?)\]\((.+?)\)/g,'<img src="$2" alt="$1">'),J=J.replace(/`(.+?)`/g,"<code>$1</code>"),J="<p>"+J+"</p>",J}function x4(J){return J.trim().toLowerCase().replace(/\s+/g,"-")}function m(){var J=Y.get("messagesContainer").elm;J.scrollTop=J.scrollHeight}async function R1(J,Z){try{const Q=Y.get("userSettings"),D={user:Y.get("userName"),useUserName:Y.get("userSettings").includeUsername,prompt:J,botPrompt:Y.get("select").elm.value,customSettings:{temp:parseFloat(Y.get("customSettings_temp").elm.value),system:Y.get("customSettings_systemPrompt").elm.value},rememberContext:Y.get("userSettings").rememberContext,context:Y.get("messageHistory").filter((N)=>N!==null).slice(0,Y.get("messageHistory").length-1),userSettings:{timeZone:Q.timeZone,promptPrefix:Q.promptPrefixEnabled===!0?Q.promptPrefix:"",testMode:Q.testMode,ctxLength:Q.ctxLength,maxTokens:Q.maxTokens}},V={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(D)};let K=!0,X=null;const z=await fetch("/api/stream",V).then(async(N)=>{if(!N.ok){console.log("whoops"),K=!1;let F=await N.json();switch(F.errorCode){case"too_many_requests":X=`You have used too many requests (${apiUsage.used} of ${apiUsage.total}) in the past hour. Please try again ${futureDate(new Date(apiUsage.expires))} from now.`;break;default:X=F.errorMessage;break}}else return N}).catch((N)=>{K=!1,X=N});if(K===!1){console.log("shouldContinue FAILED"),Z({unfilteredMsg:`<div id='AI_TEMP_ERR' class='error'>${X}</div>`}),Z(!0);return}const G=z.body.getReader();let w=new TextDecoder,R="";window.addEventListener("chatify-premature-end",(N)=>{Z(!0)}),Y.set("currentSocket",G),G.read().then(async function N(F){if(F.done)return;let P=w.decode(F.value);R+=P.replace(/data:/g,"");const f=R.split("\n");R=f.pop();for(let C of f)try{const T=JSON.parse(C);if(T.type==="done"){Z(!0);break}else if(T.type==="error"){let L=T.data;switch(L){case"invalid_api_key":L="The owner of this instance has not set up their API key properly, this is not a problem on your end.";break;case"too_many_requests":break}Z({unfilteredMsg:`<div id='AI_TEMP_ERR' class='error'>Something went wrong: ${L}</div>`}),Z(!0);return}else if(T.type==="inc")await new Promise((L)=>{setTimeout(L,0)}),Z({msg:T.data.replace(/\\n/g,"\n")})}catch(T){}return G.read().then(N)}).catch((N)=>{return console.error(N),Z({unfilteredMsg:`<div id='AI_TEMP_ERR' class='error'>Sorry, but there was an error while loading the response: ${N}</div>`}),Z(!0)})}catch(Q){return console.error(Q),Z({unfilteredMsg:`<div id='AI_TEMP_ERR' class='error'>Sorry, but there was an error while loading the response: ${Q}</div>`}),Z(!0)}}async function h4(J,Z){return new Promise((Q,D)=>{let V="";J.querySelector(".data .text").innerHTML="",J.classList.add("thinking");let K=[];R1(Z,(X)=>{if(X===!0)return J.classList.remove("thinking"),window.messages=K,window.dispatchEvent(new CustomEvent("chatify-message-complete",{detail:{data:V}})),Q(V);if(X===!1)J.querySelector(".data .text").innerHTML="";if(X.unfilteredMsg){V+=X.unfilteredMsg,J.querySelector(".data .text").innerHTML=V;return}if(!X.msg)return console.log("?!");V+=X.msg,J.querySelector(".data .text").innerHTML=DOMPurify.sanitize(J4(V)),m(),window.sourceMessage=V,window.previousMessage=X,window.finalHtml=J.querySelector(".data .text").innerHTML})})}var k={trashCan:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 6h18"></path><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"></path><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>',chevron:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"></polyline></svg>',checkMark:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>',stop:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect></svg>',send:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg>',retry:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-refresh-cw"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></svg>',copy:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"/><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/></svg>',edit:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-pencil"><path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"/><path d="m15 5 4 4"/></svg>'};function Z4(J){const Z=Y.get("inputArea");Z.elm.style.height="auto",Z.elm.style.height=Z.elm.scrollHeight+2+"px";const Q=Z.elm.offsetHeight;Y.get("messagesContainer").elm.style.paddingBottom=`${Q+12}px`}function u4(){const J=new $().class("messages-wrapper").style({display:"flex",flexDirection:"row",gap:"8px",alignItems:"flex-end"}),Z=new $().class("messages").appendTo(J);Y.set("messagesContainer",Z);const Q=new $().classOn("row","py-0","align-end").appendTo(J),D=new $("textarea").classOn("fg").attr({type:"text",placeholder:"Message",rows:"1"}).style({resize:"vertical","min-height":"34px"}).appendTo(Q);D.style({height:"35px"});const V=new $("button").html(k.send).classOn("fg-auto").appendTo(Q);if(Y.set("sendButton",V),J.appendTo("body"),Y.set("messagesWrapper",J),D.elm.addEventListener("input",Z4),D.elm.addEventListener("change",Z4),window.addEventListener("resize",Z4),!/Mobi/.test(navigator.userAgent))D.elm.addEventListener("keydown",(X)=>{if((X.code||X.key)==="Enter"&&!X.shiftKey){if(X.preventDefault(),X.target.value)F4()}});Y.set("inputArea",D)}function X4(J=0,Z,Q,D=null,V=!1,K=!0){if(Q===void 0)Q=Y.get("messageHistory").length;const X=new $().class("message"),z=new $().class("wrapper").appendTo(X),O=new $().class("icon").appendTo(z),G=new $().class("data","fg-max").appendTo(z),w=new $().class("column").appendTo(X),R=new $().class("name").appendTo(G),N=new $().class("text").appendTo(G);switch(J){case 0:if(X.class("user"),G.class("muted"),N.html(Z),D)R.text(D);else R.text(Y.get("userName"));break;case 1:X.class("gpt");const F=Y.get("select");if(X.elm.dataset.mode=F.elm.value,R.text(F.elm.querySelector('select option[value="'+F.elm.value+'"]').value),D!==null){if(D.avatar!==null&&D.avatar!==void 0)X.style({"--icon":"url("+D.avatar+")"});else X.style({"--icon":"url(./assets/avatars/builtin/custom.svg)"});if(D.displayName!==null&&D.displayName!==void 0)R.text(D.displayName)}if(F.elm.value==="custom"){if(Y.get("aiAvatarOverride")!==!1)O.style({"background-image":"url("+Y.get("aiAvatarOverride")+")"});if(Y.get("aiNameOverride")!==!1)R.text(Y.get("aiNameOverride"))}if(V===!0)R.elm.innerHTML+='<span class="badge">System</span>';break}if(V===!1||K===!0)w.appendMany(new $("button").class("transparent","fg-auto","small").html(k.trashCan).on("click",(F)=>{let P;const f=new $().text("Are you sure you want to delete this message?").append(new $().classOn("fg-auto","row").append(new $("button").text("OK").classOn("fg-auto").on("click",(C)=>{Y.get("messageHistory")[Q]=null,window.mh=Y.get("messageHistory"),X.cleanup(),P.hide()})).append(new $("button").text("Cancel").classOn("danger","fg-auto").on("click",(C)=>{P.hide()})));P=new B(f),P.show()}),new $("button").class("transparent","fg-auto","small").html(k.copy).on("click",(F)=>{let P=Y.get("messageHistory")[Q].content;if(navigator.clipboard)navigator.clipboard.writeText(P);else{var f=document.createElement("textarea");f.value=P,document.body.appendChild(f),f.select(),document.execCommand("copy"),document.body.removeChild(f)}}),new $("button").class("transparent","fg-auto","small").html(k.edit).on("click",(F)=>{let P=Y.get("messageHistory")[Q].content;const f=new $("textarea").classOn("mt-1").attr({rows:8,placeholder:"Message content is empty"}).val(P);let C;const T=new $().text(`Edit Message #${Q}`).appendMany(f,new $().classOn("fg-auto","row").append(new $("button").text("OK").classOn("fg-auto").on("click",(L)=>{let _=f.getValue();n(X.elm,_),Y.get("messageHistory")[Q].content=_,C.hide()})).append(new $("button").text("Cancel").classOn("danger","fg-auto").on("click",(L)=>{C.hide()})));C=new B(T),C.show()}));else w.append(new $("button").class("transparent").html(k.trashCan).on("click",(F)=>{let P;const f=new $().text("Are you sure you want to delete this message?").append(new $().classOn("fg-auto","row").append(new $("button").text("OK").classOn("fg-auto").on("click",(C)=>{X.cleanup(),P.hide()})).append(new $("button").text("Cancel").classOn("danger","fg-auto").on("click",(C)=>{P.hide()})));P=new B(f),P.show()}));return X.appendTo(Y.get("messagesContainer")),window.mh=Y.get("messageHistory"),m(),X}function n(J,Z=null){if(J.querySelector(".data").classList.remove("muted","dots-flow"),Z!==null){if(Z.startsWith('"'))Z=Z.slice(1);if(Z.endsWith('"'))Z=Z.slice(0,-1);J.querySelector(".data .text").innerHTML=DOMPurify.sanitize(J4(Z))}}async function U1(J,Z=!0){const Q=Y.get("messageHistory").push({role:"user",content:J,name:Y.get("userSettings").username})-1,D=Y.get("messageHistory").push({role:"assistant",type:Y.get("select").elm.value,content:"Thinking..."})-1;if(Y.get("select").elm.value==="custom")if(!Y.get("loadedCustomPrompt").id);else Y.get("messageHistory")[D].promptId=Y.get("loadedCustomPrompt").id;const V=prompts.find((O)=>O.id===Y.get("select").elm.value)||prompts[0];let K;if(Z===!0)K=X4(0,DOMPurify.sanitize(J4(J)),Q);let X=X4(1,"",D,V);$4=!0,K4(),Y.get("deleteConvoButton").elm.disabled=!0;let z=await h4(X.elm,J,Y.get("messageHistory").slice(0,Y.get("messageHistory").length-1));n(K.elm),Y.get("messageHistory")[D].content=z,$4=!1,K4(),Y.get("deleteConvoButton").elm.disabled=!1,await e(),D4()}function F4(){if($4)return!1;if(U1(Y.get("inputArea").elm.value),Y.get("inputArea").elm.value="",m(),Z4(),d4===!1)console.log("setting b4unload!"),window.addEventListener("beforeunload",F1,{capture:!0}),d4=!0}function p4(){try{if(Y.get("currentSocket")?.cancel)Y.get("currentSocket").cancel("stop button").then(()=>{window.dispatchEvent(new CustomEvent("chatify-premature-end",{detail:{data:"stop button",error:!1}}))})}catch(J){console.log("failed to close")}}function c4(){if(!$4)F4()}function K4(){switch($4){case!0:Y.get("inputArea").attr({placeholder:"Thinking..."}),Y.get("sendButton").classOn("neutral").html(k.stop).on("click",p4).un("click",c4);break;case!1:Y.get("inputArea").attr({placeholder:"Message"}),Y.get("sendButton").classOff("neutral").html(k.send).on("click",c4).un("click",p4);break}}var $4=!1,N1=null,d4=!1;Y.set("currentSocket",N1);var F1=(J)=>{return(J||window.event).returnValue=null,null};function W4(J){return new $("button").text("Conversation...").class("fg").appendTo(J).on("click",()=>{const Z=new $("div").text("What do you want to do?").append(new $().classOn("row").appendMany(new $("button").text("Import").classOn("fg-auto").on("click",(D)=>{const V=new $("textarea").attr({rows:8,placeholder:'[ {"role": ..., "content": ...}, ... ]'}),K=new $("div").text("Import JSON data:").append(new $().classOn("column").appendMany(V,new $("button").text("Attempt Import").classOn("fg-auto").on("click",(z)=>{try{const O=JSON.parse(V.elm.value);if(this.confirm("Are you sure you want to import?\nYou will lose your current conversation if it has not been saved.")===!0){if(X.hide(),Array.isArray(O)){let G=O.filter((w)=>{if(w!==null&&w.content&&w.role){if(w.role==="assistant"){if(w.type==="custom"||prompts.find((R)=>R.id===w.type)!==void 0)return!0}else if(w.role==="user")return!0;return!1}});actuallyClearMessageHistory(),Y.set("messageHistory",G);for(let w=0;w<G.length;w++){const R=G[w];if(setPrompt(prompts.find((C)=>C.id===R.type)||prompts[0],!1),assistantObj===null)assistantObj=loadAssistant();let N={},F=(R.promptId!==void 0&&(R.promptId in assistantObj))===!0;if(F){N=assistantObj[R.promptId];const C=JSON.stringify(N);setPrompt({id:"custom",label:"Custom"}),importAndLoadPrompt(C,(T)=>{})}const P=R.role==="assistant"?R.type==="custom"?F?{label:N.name,id:"custom",greeting:"Unset",hint:"Unset",type:"custom",avatar:N.avatar,displayName:N.name}:{label:"Custom (unknown)",id:"custom",greeting:"Unset",hint:"Unset",type:"builtIn",avatar:"./assets/avatars/builtin/custom.svg",displayName:"Custom (unknown)"}:prompts.find((C)=>C.id===R.type):R.name??"User";let f=makeMessage(R.role==="user"?0:1,"Thinking...",w,P);if(R.role==="user")n(f.elm,R.content);else f.query(".data .text").innerHTML=DOMPurify.sanitize(parseMarkdown(R.content))}makeMsgSeparator()}}}catch{X.hide()}})));Q.hide();let X=new B(K);X.show()}),new $("button").text("Export").classOn("fg-auto").on("click",(D)=>{Q.hide();const V=new $("div").text("Here's your conversation:").append(new $("textarea").attr({rows:8}).html(JSON.stringify(Y.get("messageHistory").filter((X)=>X!==null))));new B(V).show()}))),Q=new B(Z);Q.show()})}var d=function(J){return!Array.isArray?a4(J)==="[object Array]":Array.isArray(J)},E1=function(J){if(typeof J=="string")return J;let Z=J+"";return Z=="0"&&1/J==-W1?"-0":Z},P1=function(J){return J==null?"":E1(J)},h=function(J){return typeof J==="string"},r4=function(J){return typeof J==="number"},A1=function(J){return J===!0||J===!1||f1(J)&&a4(J)=="[object Boolean]"},s4=function(J){return typeof J==="object"},f1=function(J){return s4(J)&&J!==null},b=function(J){return J!==void 0&&J!==null},E4=function(J){return!J.trim().length},a4=function(J){return J==null?J===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(J)},e4=function(J){let Z=null,Q=null,D=null,V=1,K=null;if(h(J)||d(J))D=J,Z=l4(J),Q=P4(J);else{if(!m4.call(J,"name"))throw new Error(L1("name"));const X=J.name;if(D=X,m4.call(J,"weight")){if(V=J.weight,V<=0)throw new Error(q1(X))}Z=l4(X),Q=P4(X),K=J.getFn}return{path:Z,id:Q,weight:V,src:D,getFn:K}},l4=function(J){return d(J)?J:J.split(".")},P4=function(J){return d(J)?J.join("."):J},T1=function(J,Z){let Q=[],D=!1;const V=(K,X,z)=>{if(!b(K))return;if(!X[z])Q.push(K);else{let O=X[z];const G=K[O];if(!b(G))return;if(z===X.length-1&&(h(G)||r4(G)||A1(G)))Q.push(P1(G));else if(d(G)){D=!0;for(let w=0,R=G.length;w<R;w+=1)V(G[w],X,z+1)}else if(X.length)V(G,X,z+1)}};return V(J,h(Z)?Z.split("."):Z,0),D?Q:Q[0]},M1=function(J=1,Z=3){const Q=new Map,D=Math.pow(10,Z);return{get(V){const K=V.match(v1).length;if(Q.has(K))return Q.get(K);const X=1/Math.pow(K,0.5*J),z=parseFloat(Math.round(X*D)/D);return Q.set(K,z),z},clear(){Q.clear()}}},J1=function(J,Z,{getFn:Q=W.getFn,fieldNormWeight:D=W.fieldNormWeight}={}){const V=new G4({getFn:Q,fieldNormWeight:D});return V.setKeys(J.map(e4)),V.setSources(Z),V.create(),V},k1=function(J,{getFn:Z=W.getFn,fieldNormWeight:Q=W.fieldNormWeight}={}){const{keys:D,records:V}=J,K=new G4({getFn:Z,fieldNormWeight:Q});return K.setKeys(D),K.setIndexRecords(V),K},z4=function(J,{errors:Z=0,currentLocation:Q=0,expectedLocation:D=0,distance:V=W.distance,ignoreLocation:K=W.ignoreLocation}={}){const X=Z/J.length;if(K)return X;const z=Math.abs(D-Q);if(!V)return z?1:X;return X+z/V},b1=function(J=[],Z=W.minMatchCharLength){let Q=[],D=-1,V=-1,K=0;for(let X=J.length;K<X;K+=1){let z=J[K];if(z&&D===-1)D=K;else if(!z&&D!==-1){if(V=K-1,V-D+1>=Z)Q.push([D,V]);D=-1}}if(J[K-1]&&K-D>=Z)Q.push([D,K-1]);return Q},y1=function(J,Z,Q,{location:D=W.location,distance:V=W.distance,threshold:K=W.threshold,findAllMatches:X=W.findAllMatches,minMatchCharLength:z=W.minMatchCharLength,includeMatches:O=W.includeMatches,ignoreLocation:G=W.ignoreLocation}={}){if(Z.length>l)throw new Error(B1(l));const w=Z.length,R=J.length,N=Math.max(0,Math.min(D,R));let F=K,P=N;const f=z>1||O,C=f?Array(R):[];let T;while((T=J.indexOf(Z,P))>-1){let j=z4(Z,{currentLocation:T,expectedLocation:N,distance:V,ignoreLocation:G});if(F=Math.min(j,F),P=T+w,f){let v=0;while(v<w)C[T+v]=1,v+=1}}P=-1;let L=[],_=1,q=w+R;const Q4=1<<w-1;for(let j=0;j<w;j+=1){let v=0,I=q;while(v<I){if(z4(Z,{errors:j,currentLocation:N+I,expectedLocation:N,distance:V,ignoreLocation:G})<=F)v=I;else q=I;I=Math.floor((q-v)/2+v)}q=I;let i=Math.max(1,N-I+1),A=X?R:Math.min(N+I,R)+w,y=Array(A+2);y[A+1]=(1<<j)-1;for(let S=A;S>=i;S-=1){let g=S-1,E=Q[J.charAt(g)];if(f)C[g]=+!!E;if(y[S]=(y[S+1]<<1|1)&E,j)y[S]|=(L[S+1]|L[S])<<1|1|L[S+1];if(y[S]&Q4){if(_=z4(Z,{errors:j,currentLocation:g,expectedLocation:N,distance:V,ignoreLocation:G}),_<=F){if(F=_,P=g,P<=N)break;i=Math.max(1,2*N-P)}}}if(z4(Z,{errors:j+1,currentLocation:N,expectedLocation:N,distance:V,ignoreLocation:G})>F)break;L=y}const u={isMatch:P>=0,score:Math.max(0.001,_)};if(f){const j=b1(C,z);if(!j.length)u.isMatch=!1;else if(O)u.indices=j}return u},g1=function(J){let Z={};for(let Q=0,D=J.length;Q<D;Q+=1){const V=J.charAt(Q);Z[V]=(Z[V]||0)|1<<D-Q-1}return Z},i4=function(J,Z){const Q=J.match(Z);return Q?Q[1]:null},u1=function(J,Z={}){return J.split(h1).map((Q)=>{let D=Q.trim().split(x1).filter((K)=>K&&!!K.trim()),V=[];for(let K=0,X=D.length;K<X;K+=1){const z=D[K];let O=!1,G=-1;while(!O&&++G<n4){const w=A4[G];let R=w.isMultiMatch(z);if(R)V.push(new w(R,Z)),O=!0}if(O)continue;G=-1;while(++G<n4){const w=A4[G];let R=w.isSingleMatch(z);if(R){V.push(new w(R,Z));break}}}return V})},p1=function(...J){f4.push(...J)},_4=function(J,Z){for(let Q=0,D=f4.length;Q<D;Q+=1){let V=f4[Q];if(V.condition(J,Z))return new V(J,Z)}return new L4(J,Z)},K1=function(J,Z,{auto:Q=!0}={}){const D=(V)=>{let K=Object.keys(V);const X=c1(V);if(!X&&K.length>1&&!B4(V))return D(o4(V));if(m1(V)){const O=X?V[C4.PATH]:K[0],G=X?V[C4.PATTERN]:V[O];if(!h(G))throw new Error(C1(O));const w={keyId:P4(O),pattern:G};if(Q)w.searcher=_4(G,Z);return w}let z={children:[],operator:K[0]};return K.forEach((O)=>{const G=V[O];if(d(G))G.forEach((w)=>{z.children.push(D(w))})}),z};if(!B4(J))J=o4(J);return D(J)},l1=function(J,{ignoreFieldNorm:Z=W.ignoreFieldNorm}){J.forEach((Q)=>{let D=1;Q.matches.forEach(({key:V,norm:K,score:X})=>{const z=V?V.weight:null;D*=Math.pow(X===0&&z?Number.EPSILON:X,(z||1)*(Z?1:K))}),Q.score=D})},i1=function(J,Z){const Q=J.matches;if(Z.matches=[],!b(Q))return;Q.forEach((D)=>{if(!b(D.indices)||!D.indices.length)return;const{indices:V,value:K}=D;let X={indices:V,value:K};if(D.key)X.key=D.key.src;if(D.idx>-1)X.refIndex=D.idx;Z.matches.push(X)})},n1=function(J,Z){Z.score=J.score},o1=function(J,Z,{includeMatches:Q=W.includeMatches,includeScore:D=W.includeScore}={}){const V=[];if(Q)V.push(i1);if(D)V.push(n1);return J.map((K)=>{const{idx:X}=K,z={item:Z[X],refIndex:X};if(V.length)V.forEach((O)=>{O(K,z)});return z})},W1=Infinity;var _1="Incorrect 'index' type",C1=(J)=>`Invalid value for key ${J}`,B1=(J)=>`Pattern length exceeds max of ${J}.`,L1=(J)=>`Missing ${J} property in key`,q1=(J)=>`Property 'weight' in key '${J}' must be a positive integer`,m4=Object.prototype.hasOwnProperty;class t4{constructor(J){this._keys=[],this._keyMap={};let Z=0;J.forEach((Q)=>{let D=e4(Q);Z+=D.weight,this._keys.push(D),this._keyMap[D.id]=D,Z+=D.weight}),this._keys.forEach((Q)=>{Q.weight/=Z})}get(J){return this._keyMap[J]}keys(){return this._keys}toJSON(){return JSON.stringify(this._keys)}}var I1={includeMatches:!1,findAllMatches:!1,minMatchCharLength:1},S1={isCaseSensitive:!1,includeScore:!1,keys:[],shouldSort:!0,sortFn:(J,Z)=>J.score===Z.score?J.idx<Z.idx?-1:1:J.score<Z.score?-1:1},j1={location:0,threshold:0.6,distance:100},H1={useExtendedSearch:!1,getFn:T1,ignoreLocation:!1,ignoreFieldNorm:!1,fieldNormWeight:1},W={...S1,...I1,...j1,...H1},v1=/[^ ]+/g;class G4{constructor({getFn:J=W.getFn,fieldNormWeight:Z=W.fieldNormWeight}={}){this.norm=M1(Z,3),this.getFn=J,this.isCreated=!1,this.setIndexRecords()}setSources(J=[]){this.docs=J}setIndexRecords(J=[]){this.records=J}setKeys(J=[]){this.keys=J,this._keysMap={},J.forEach((Z,Q)=>{this._keysMap[Z.id]=Q})}create(){if(this.isCreated||!this.docs.length)return;if(this.isCreated=!0,h(this.docs[0]))this.docs.forEach((J,Z)=>{this._addString(J,Z)});else this.docs.forEach((J,Z)=>{this._addObject(J,Z)});this.norm.clear()}add(J){const Z=this.size();if(h(J))this._addString(J,Z);else this._addObject(J,Z)}removeAt(J){this.records.splice(J,1);for(let Z=J,Q=this.size();Z<Q;Z+=1)this.records[Z].i-=1}getValueForItemAtKeyId(J,Z){return J[this._keysMap[Z]]}size(){return this.records.length}_addString(J,Z){if(!b(J)||E4(J))return;let Q={v:J,i:Z,n:this.norm.get(J)};this.records.push(Q)}_addObject(J,Z){let Q={i:Z,$:{}};this.keys.forEach((D,V)=>{let K=D.getFn?D.getFn(J):this.getFn(J,D.path);if(!b(K))return;if(d(K)){let X=[];const z=[{nestedArrIndex:-1,value:K}];while(z.length){const{nestedArrIndex:O,value:G}=z.pop();if(!b(G))continue;if(h(G)&&!E4(G)){let w={v:G,i:O,n:this.norm.get(G)};X.push(w)}else if(d(G))G.forEach((w,R)=>{z.push({nestedArrIndex:R,value:w})})}Q.$[V]=X}else if(h(K)&&!E4(K)){let X={v:K,n:this.norm.get(K)};Q.$[V]=X}}),this.records.push(Q)}toJSON(){return{keys:this.keys,records:this.records}}}var l=32;class L4{constructor(J,{location:Z=W.location,threshold:Q=W.threshold,distance:D=W.distance,includeMatches:V=W.includeMatches,findAllMatches:K=W.findAllMatches,minMatchCharLength:X=W.minMatchCharLength,isCaseSensitive:z=W.isCaseSensitive,ignoreLocation:O=W.ignoreLocation}={}){if(this.options={location:Z,threshold:Q,distance:D,includeMatches:V,findAllMatches:K,minMatchCharLength:X,isCaseSensitive:z,ignoreLocation:O},this.pattern=z?J:J.toLowerCase(),this.chunks=[],!this.pattern.length)return;const G=(R,N)=>{this.chunks.push({pattern:R,alphabet:g1(R),startIndex:N})},w=this.pattern.length;if(w>l){let R=0;const N=w%l,F=w-N;while(R<F)G(this.pattern.substr(R,l),R),R+=l;if(N){const P=w-l;G(this.pattern.substr(P),P)}}else G(this.pattern,0)}searchIn(J){const{isCaseSensitive:Z,includeMatches:Q}=this.options;if(!Z)J=J.toLowerCase();if(this.pattern===J){let F={isMatch:!0,score:0};if(Q)F.indices=[[0,J.length-1]];return F}const{location:D,distance:V,threshold:K,findAllMatches:X,minMatchCharLength:z,ignoreLocation:O}=this.options;let G=[],w=0,R=!1;this.chunks.forEach(({pattern:F,alphabet:P,startIndex:f})=>{const{isMatch:C,score:T,indices:L}=y1(J,F,P,{location:D+f,distance:V,threshold:K,findAllMatches:X,minMatchCharLength:z,includeMatches:Q,ignoreLocation:O});if(C)R=!0;if(w+=T,C&&L)G=[...G,...L]});let N={isMatch:R,score:R?w/this.chunks.length:1};if(R&&Q)N.indices=G;return N}}class p{constructor(J){this.pattern=J}static isMultiMatch(J){return i4(J,this.multiRegex)}static isSingleMatch(J){return i4(J,this.singleRegex)}search(){}}class Z1 extends p{constructor(J){super(J)}static get type(){return"exact"}static get multiRegex(){return/^="(.*)"$/}static get singleRegex(){return/^=(.*)$/}search(J){const Z=J===this.pattern;return{isMatch:Z,score:Z?0:1,indices:[0,this.pattern.length-1]}}}class $1 extends p{constructor(J){super(J)}static get type(){return"inverse-exact"}static get multiRegex(){return/^!"(.*)"$/}static get singleRegex(){return/^!(.*)$/}search(J){const Q=J.indexOf(this.pattern)===-1;return{isMatch:Q,score:Q?0:1,indices:[0,J.length-1]}}}class Q1 extends p{constructor(J){super(J)}static get type(){return"prefix-exact"}static get multiRegex(){return/^\^"(.*)"$/}static get singleRegex(){return/^\^(.*)$/}search(J){const Z=J.startsWith(this.pattern);return{isMatch:Z,score:Z?0:1,indices:[0,this.pattern.length-1]}}}class V1 extends p{constructor(J){super(J)}static get type(){return"inverse-prefix-exact"}static get multiRegex(){return/^!\^"(.*)"$/}static get singleRegex(){return/^!\^(.*)$/}search(J){const Z=!J.startsWith(this.pattern);return{isMatch:Z,score:Z?0:1,indices:[0,J.length-1]}}}class Y1 extends p{constructor(J){super(J)}static get type(){return"suffix-exact"}static get multiRegex(){return/^"(.*)"\$$/}static get singleRegex(){return/^(.*)\$$/}search(J){const Z=J.endsWith(this.pattern);return{isMatch:Z,score:Z?0:1,indices:[J.length-this.pattern.length,J.length-1]}}}class D1 extends p{constructor(J){super(J)}static get type(){return"inverse-suffix-exact"}static get multiRegex(){return/^!"(.*)"\$$/}static get singleRegex(){return/^!(.*)\$$/}search(J){const Z=!J.endsWith(this.pattern);return{isMatch:Z,score:Z?0:1,indices:[0,J.length-1]}}}class q4 extends p{constructor(J,{location:Z=W.location,threshold:Q=W.threshold,distance:D=W.distance,includeMatches:V=W.includeMatches,findAllMatches:K=W.findAllMatches,minMatchCharLength:X=W.minMatchCharLength,isCaseSensitive:z=W.isCaseSensitive,ignoreLocation:O=W.ignoreLocation}={}){super(J);this._bitapSearch=new L4(J,{location:Z,threshold:Q,distance:D,includeMatches:V,findAllMatches:K,minMatchCharLength:X,isCaseSensitive:z,ignoreLocation:O})}static get type(){return"fuzzy"}static get multiRegex(){return/^"(.*)"$/}static get singleRegex(){return/^(.*)$/}search(J){return this._bitapSearch.searchIn(J)}}class T4 extends p{constructor(J){super(J)}static get type(){return"include"}static get multiRegex(){return/^'"(.*)"$/}static get singleRegex(){return/^'(.*)$/}search(J){let Z=0,Q;const D=[],V=this.pattern.length;while((Q=J.indexOf(this.pattern,Z))>-1)Z=Q+V,D.push([Q,Z-1]);const K=!!D.length;return{isMatch:K,score:K?0:1,indices:D}}}var A4=[Z1,T4,Q1,V1,D1,Y1,$1,q4],n4=A4.length,x1=/ +(?=(?:[^\"]*\"[^\"]*\")*[^\"]*$)/,h1="|",d1=new Set([q4.type,T4.type]);class X1{constructor(J,{isCaseSensitive:Z=W.isCaseSensitive,includeMatches:Q=W.includeMatches,minMatchCharLength:D=W.minMatchCharLength,ignoreLocation:V=W.ignoreLocation,findAllMatches:K=W.findAllMatches,location:X=W.location,threshold:z=W.threshold,distance:O=W.distance}={}){this.query=null,this.options={isCaseSensitive:Z,includeMatches:Q,minMatchCharLength:D,findAllMatches:K,ignoreLocation:V,location:X,threshold:z,distance:O},this.pattern=Z?J:J.toLowerCase(),this.query=u1(this.pattern,this.options)}static condition(J,Z){return Z.useExtendedSearch}searchIn(J){const Z=this.query;if(!Z)return{isMatch:!1,score:1};const{includeMatches:Q,isCaseSensitive:D}=this.options;J=D?J:J.toLowerCase();let V=0,K=[],X=0;for(let z=0,O=Z.length;z<O;z+=1){const G=Z[z];K.length=0,V=0;for(let w=0,R=G.length;w<R;w+=1){const N=G[w],{isMatch:F,indices:P,score:f}=N.search(J);if(F){if(V+=1,X+=f,Q){const C=N.constructor.type;if(d1.has(C))K=[...K,...P];else K.push(P)}}else{X=0,V=0,K.length=0;break}}if(V){let w={isMatch:!0,score:X/V};if(Q)w.indices=K;return w}}return{isMatch:!1,score:1}}}var f4=[],w4={AND:"$and",OR:"$or"},C4={PATH:"$path",PATTERN:"$val"},B4=(J)=>!!(J[w4.AND]||J[w4.OR]),c1=(J)=>!!J[C4.PATH],m1=(J)=>!d(J)&&s4(J)&&!B4(J),o4=(J)=>({[w4.AND]:Object.keys(J).map((Z)=>({[Z]:J[Z]}))});class c{constructor(J,Z={},Q){this.options={...W,...Z},this.options.useExtendedSearch,this._keyStore=new t4(this.options.keys),this.setCollection(J,Q)}setCollection(J,Z){if(this._docs=J,Z&&!(Z instanceof G4))throw new Error(_1);this._myIndex=Z||J1(this.options.keys,this._docs,{getFn:this.options.getFn,fieldNormWeight:this.options.fieldNormWeight})}add(J){if(!b(J))return;this._docs.push(J),this._myIndex.add(J)}remove(J=()=>!1){const Z=[];for(let Q=0,D=this._docs.length;Q<D;Q+=1){const V=this._docs[Q];if(J(V,Q))this.removeAt(Q),Q-=1,D-=1,Z.push(V)}return Z}removeAt(J){this._docs.splice(J,1),this._myIndex.removeAt(J)}getIndex(){return this._myIndex}search(J,{limit:Z=-1}={}){const{includeMatches:Q,includeScore:D,shouldSort:V,sortFn:K,ignoreFieldNorm:X}=this.options;let z=h(J)?h(this._docs[0])?this._searchStringList(J):this._searchObjectList(J):this._searchLogical(J);if(l1(z,{ignoreFieldNorm:X}),V)z.sort(K);if(r4(Z)&&Z>-1)z=z.slice(0,Z);return o1(z,this._docs,{includeMatches:Q,includeScore:D})}_searchStringList(J){const Z=_4(J,this.options),{records:Q}=this._myIndex,D=[];return Q.forEach(({v:V,i:K,n:X})=>{if(!b(V))return;const{isMatch:z,score:O,indices:G}=Z.searchIn(V);if(z)D.push({item:V,idx:K,matches:[{score:O,value:V,norm:X,indices:G}]})}),D}_searchLogical(J){const Z=K1(J,this.options),Q=(X,z,O)=>{if(!X.children){const{keyId:w,searcher:R}=X,N=this._findMatches({key:this._keyStore.get(w),value:this._myIndex.getValueForItemAtKeyId(z,w),searcher:R});if(N&&N.length)return[{idx:O,item:z,matches:N}];return[]}const G=[];for(let w=0,R=X.children.length;w<R;w+=1){const N=X.children[w],F=Q(N,z,O);if(F.length)G.push(...F);else if(X.operator===w4.AND)return[]}return G},D=this._myIndex.records,V={},K=[];return D.forEach(({$:X,i:z})=>{if(b(X)){let O=Q(Z,X,z);if(O.length){if(!V[z])V[z]={idx:z,item:X,matches:[]},K.push(V[z]);O.forEach(({matches:G})=>{V[z].matches.push(...G)})}}}),K}_searchObjectList(J){const Z=_4(J,this.options),{keys:Q,records:D}=this._myIndex,V=[];return D.forEach(({$:K,i:X})=>{if(!b(K))return;let z=[];if(Q.forEach((O,G)=>{z.push(...this._findMatches({key:O,value:K[G],searcher:Z}))}),z.length)V.push({idx:X,item:K,matches:z})}),V}_findMatches({key:J,value:Z,searcher:Q}){if(!b(Z))return[];let D=[];if(d(Z))Z.forEach(({v:V,i:K,n:X})=>{if(!b(V))return;const{isMatch:z,score:O,indices:G}=Q.searchIn(V);if(z)D.push({score:O,key:J,value:V,idx:K,norm:X,indices:G})});else{const{v:V,n:K}=Z,{isMatch:X,score:z,indices:O}=Q.searchIn(V);if(X)D.push({score:z,key:J,value:V,norm:K,indices:O})}return D}}c.version="6.6.2";c.createIndex=J1;c.parseIndex=k1;c.config=W;c.parseQuery=K1;p1(X1);function O4(J,Z=!0){const Q=Y.get("select");if(Q.elm.value=J.id,Y.get("selectPromptBtn").text(J.label),I4=J,Q.elm.value==="custom")Y.get("customSettingsWrapper").classOff("hidden");else Y.get("customSettingsWrapper").classOn("hidden");if(Z===!0){if(J.greetingMessages&&Array.isArray(J.greetingMessages)){const D=J.greetingMessages[Math.floor(Math.random()*J.greetingMessages.length)],V=Y.get("messageHistory").push({role:"assistant",clientSide:!0,type:Q.elm.value,content:D})-1,K=X4(1,"",V,J,!0);let X="";Y.get("selectPromptBtn").elm.disabled=!0;let z=0;const O=()=>{if(z>=D.length)Y.get("selectPromptBtn").elm.disabled=!1;else X+=D[z],n(K.elm,X),z++,setTimeout(O,Math.floor(Math.random()*15)/4)};setTimeout(O,Math.floor(Math.random()*15)/4)}}return I4}function S4(J="builtIn"){return new Promise((Z,Q)=>{const D=new $().classOn("row").classOn("fg"),V=new $().classOn("fg-max");function K(_,q){O.classOn("extra-hidden"),w.classOn("extra-hidden"),N.classOn("extra-hidden"),z.classOff("selected"),G.classOff("selected"),R.classOff("selected"),_.classOn("selected"),q.classOff("extra-hidden")}function X(_,q,Q4){function u(A){return new $().classOn("prompt").appendMany(new $().classOn("assistant").appendMany(new $().classOn("who").attr({"data-mode":A.id,style:A.avatar!==null&&A.avatar!==void 0?`--icon:url(${A.avatar})`:"--icon:url(./assets/avatars/builtin/custom.svg)"}).appendMany(new $().classOn("icon"),new $().classOn("name").attr({title:A.id}).text(A.label)),new $().classOn("greeting").text(A.greeting),new $().classOn("hint").text(A.hint)),new $().classOn("controls").appendMany(new $("button").text("Select").on("click",(y)=>{if(A.type!=="saved")O4(A),L.hide(),Z(A);else{O4({id:"custom",label:"Custom"}),Y.set("loadedCustomPrompt",F[A.id]),Y.get("loadedCustomPrompt").id=A.id;const x=JSON.stringify(Y.get("loadedCustomPrompt"));t(x,()=>{L.hide(),Z(I4)})}}),Q4===!0?new $("button").text("Delete").classOn("danger").on("click",(y)=>{if(A.type!=="saved")O4(A),L.hide();else{let x;const S=new $().appendMany(new $("p").class("mt-0").text("Are you sure you want to delete this prompt?"),new $().classOn("prompt-box").append(new $().classOn("prompt").append(new $().classOn("assistant").appendMany(new $().classOn("who").attr({"data-mode":A.id,style:A.avatar!==null&&A.avatar!==void 0?`--icon:url(${A.avatar})`:"--icon:url(./assets/avatars/builtin/custom.svg)"}).appendMany(new $().classOn("icon"),new $().classOn("name").attr({title:A.id}).text(A.label)),new $().classOn("greeting").text(A.greeting),new $().classOn("hint").text(A.hint)))),new $().classOn("fg-auto","row","pb-0").append(new $("button").text("OK").classOn("fg-auto").on("click",(g)=>{return N4(A.id),x.hide(),L.hide(),S4("saved")})).append(new $("button").text("Cancel").classOn("danger","fg-auto").on("click",(g)=>{x.hide()})));x=new B(S),x.show()}}):null))}const j=new $().classOn("prompt-box").appendTo(_),v=new $().classOn("prompt-box").appendTo(j),I=new $().classOn("prompt-box").appendTo(j),i=new $("input").attr({type:"text",placeholder:"Search..."}).on("input",(A)=>{const x=new c(q,{keys:["name","system","greeting","displayName","hint"],shouldSort:!0}),S=A.target.value;if(S===""){I.html(""),q.forEach((E)=>{u(E).appendTo(I)});return}const g=x.search(S);if(I.html(""),g.length>0)g.forEach((E)=>{const M=E.refIndex;u(q[M]).appendTo(I)});else I.html('<i style="color:var(--text-color-accent);">Your search had no results.</i>')});v.appendMany(new $("div").class("row","py-0").appendMany(new $("button").text("Create your own prompt").classOn("fg-auto").on("click",(A)=>{O4({id:"custom",label:"Custom"}),L.hide(),Z("custom")}),new $("button").text("Scroll to bottom").classOn("transparent","fg-auto").on("click",(A)=>{L.modal.elm.scrollTo({top:L.modal.elm.scrollHeight,behavior:"smooth"})})),i),q.forEach((A)=>{u(A).appendTo(I)})}const z=new $("button").classOn("tab-selector").classOn("fg").text("Built-In").on("click",(_)=>{K(z,O)}).appendTo(D),O=new $("div").classOn("tab").appendTo(V).append();X(O,prompts.filter((_)=>_.type==="builtIn"));const G=new $("button").classOn("tab-selector").classOn("fg").text("Community").on("click",(_)=>{K(G,w)}).appendTo(D),w=new $("div").classOn("tab").appendTo(V);X(w,prompts.filter((_)=>_.type==="community").sort((_,q)=>{if(_.hint>q.hint)return-1;if(_.hint<q.hint)return 1;return 0}));const R=new $("button").classOn("tab-selector").classOn("fg").text("Saved").on("click",(_)=>{K(R,N)}).appendTo(D),N=new $("div").classOn("tab").appendTo(V),F=a();Y.set("assistantObj",F);let P=Object.keys(F),f=Object.values(F),C=P.map((_)=>{const q=F[_];return{avatar:q.avatar!==!1?q.avatar:null,displayName:q.name!==!1?q.name:null,greeting:q.system,hint:"This is one of your custom prompts.",id:_,label:q.name!==!1?q.name:null,type:"saved"}});X(N,C,!0);const T=new $("div").class("fg").append(new $("span").text("Prompt selection")).append(new $("div").appendMany(D).appendMany(V));if(J!==void 0)switch(J){case"builtIn":K(z,O);break;case"community":K(G,w);break;case"saved":K(R,N);break}else K(z,O);const L=new B(T);L.show(),L.modal.elm.querySelector(".close-btn").addEventListener("click",(_)=>{Z(!1)})})}var I4={};var z1=function(J=JSON.parse(localStorage.getItem("user-settings"))){try{const Z=Y.get("userSettings");if(J.promptPrefix!==void 0)Z.promptPrefix=J.promptPrefix;if(J.promptPrefixEnabled!==void 0)Z.promptPrefixEnabled=J.promptPrefixEnabled;if(J.timeZone!==void 0)Z.timeZone=J.timeZone;if(J.theme!==void 0)Z.theme=J.theme;if(J.username!==void 0)Z.username=J.username;if(J.includeUsername!==void 0)Z.includeUsername=J.includeUsername;if(J.chatViewType!==void 0)Z.chatViewType=J.chatViewType;if(J.showAvatars!==void 0)Z.showAvatars=J.showAvatars;if(J.showNames!==void 0)Z.showNames=J.showNames;if(J.showCopyButton!==void 0)Z.showCopyButton=J.showCopyButton;if(J.showEditButton!==void 0)Z.showEditButton=J.showEditButton;if(J.testMode!==void 0)Z.testMode=J.testMode;if(J.ctxLength!==void 0)Z.ctxLength=J.ctxLength;if(J.maxTokens!==void 0)Z.maxTokens=J.maxTokens;if(Z.theme!==void 0&&Z.theme==="clean-dark")Z.theme="azure";if(J.promptPrefix===!1)Z.promptPrefix="";document.documentElement.dataset.theme=Z.theme,document.documentElement.dataset.chatViewType=Z.chatViewType,document.documentElement.dataset.showAvatars=Z.showAvatars,document.documentElement.dataset.showNames=Z.showNames,document.documentElement.dataset.showCopyButton=Z.showCopyButton}catch(Z){}},H=function(){localStorage.setItem("user-settings",JSON.stringify(U))},U={promptPrefix:"",promptPrefixEnabled:!0,timeZone:Intl.DateTimeFormat().resolvedOptions().timeZone||!1,theme:"clean-dark",username:"User",includeUsername:!1,rememberContext:!1,chatViewType:"cozy",showAvatars:!0,showNames:!0,showCopyButton:!0,showEditButton:!0,testMode:!1,ctxLength:"3072",maxTokens:"2048"};Y.set("userSettings",U);z1();function j4(J){return new $("button").text("Settings").class("fg").appendTo(J).on("click",()=>{const Z=new $("div").class("row"),Q=new $("button").class("fg-auto").text("Import Settings"),D=new $("button").class("fg-auto").text("Export Settings");Q.on("click",(E)=>{let M;const o=new $().text("Are you sure you want to continue importing new settings?\nYou will lose ALL your prompts and saved settings.").append(new $().classOn("fg-auto","row").append(new $("button").text("OK").classOn("danger","fg-auto").on("click",(r)=>{M.hide();const s=new $("textarea").attr({rows:8,placeholder:"{ ... }"}),b4=new $("div").text("Import JSON configuration data:").append(new $().classOn("column").appendMany(s,new $("button").text("Attempt Import").classOn("fg-auto").on("click",(r1)=>{let V4;try{if(V4=JSON.parse(s.getValue()),z1(V4),typeof V4.promptList!=="undefined")localStorage.setItem("prompts",JSON.stringify(V4.promptList));R4.hide(),g.hide(),userSettingsBtn.elm.click(),H()}catch(s1){R4.hide()}}))),R4=new B(b4);R4.show()})).append(new $("button").text("Cancel").classOn("fg-auto").on("click",(r)=>{M.hide()})));M=new B(o),M.show()}),D.on("click",(E)=>{const M=new $("textarea").attr({rows:8,placeholder:"{ ... }"});let o;try{M.val(JSON.stringify(Object.assign(JSON.parse(localStorage.getItem("user-settings")),{promptList:JSON.parse(localStorage.getItem("prompts"))}))),o=new $("div").text("Here's your exported configuration data:").append(new $().classOn("column").appendMany(M,new $("button").text("OK").classOn("fg-auto").on("click",(s)=>{r.hide()})))}catch(s){o=new $("div").text("Unable to export configuration due to parsing error:\n"+s).append(new $().classOn("column").appendMany(new $("button").text("OK").classOn("fg-auto").on("click",(b4)=>{r.hide()})))}const r=new B(o);r.show()}),Z.appendMany(Q,D);const V=new $("input").attr({type:"text",placeholder:"Username",maxlength:"24",minlength:"1"}).on("input",(E)=>{localStorage.setItem("remembered-name",V.elm.value);const M=/^[a-zA-Z0-9-]{0,24}$/.test(V.elm.value);if(Y.set("userName",M===!0?V.elm.value:"user"),U.username=Y.get("userName"),H(),M===!1)return E.target.value="User"});V.elm.value=localStorage.getItem("remembered-name")??"User",Y.set("userName",/^[a-zA-Z0-9-]{0,24}$/.test(V.elm.value)?V.elm.value:"user");const K=new $("span"),X=new $("span").appendTo(K).classOn("row"),z=new $("input").attr({id:"u",type:"checkbox",checked:U.includeUsername===!0?!0:void 0}).on("input",(E)=>{U.includeUsername=E.target.checked,H()}).appendTo(X);new $("label").attr({for:"u"}).text("Include username?").appendTo(X);const O=new $("span").appendTo(K).classOn("row","pt-0","pb-0"),G=new $("input").attr({id:"rcc",type:"checkbox",checked:U.rememberContext===!0?!0:void 0}).on("input",(E)=>{U.rememberContext=E.target.checked,H()}).appendTo(O);new $("label").attr({for:"rcc"}).text("Experimental: Remember context better").appendTo(O);const w=new $("span"),R=new $("span").appendTo(w).classOn("row"),N=new $("input").attr({id:"sha",type:"checkbox",checked:U.showAvatars===!0?!0:void 0}).on("input",(E)=>{document.documentElement.dataset.showAvatars=E.target.checked,U.showAvatars=E.target.checked,H()}).appendTo(R);new $("label").attr({for:"sha"}).text("Show avatars next to messages").appendTo(R);const F=new $("span").appendTo(w).classOn("row","pt-0"),P=new $("input").attr({id:"shn",type:"checkbox",checked:U.showNames===!0?!0:void 0}).on("input",(E)=>{document.documentElement.dataset.showNames=E.target.checked,U.showNames=E.target.checked,H()}).appendTo(F);new $("label").attr({for:"shn"}).text("Show names next to messages").appendTo(F);const f=new $("span").appendTo(w).classOn("row","pt-0"),C=new $("input").attr({id:"shc",type:"checkbox",checked:U.showCopyButton===!0?!0:void 0}).on("input",(E)=>{document.documentElement.dataset.showCopyButton=E.target.checked,U.showCopyButton=E.target.checked,H()}).appendTo(f);new $("label").attr({for:"shc"}).text("Show 'Copy' button next to messages").appendTo(f);const T=new $("span").appendTo(w).classOn("row","pt-0","pb-0"),L=new $("input").attr({id:"she",type:"checkbox",checked:U.showEditButton===!0?!0:void 0}).on("input",(E)=>{document.documentElement.dataset.showEditButton=E.target.checked,U.showEditButton=E.target.checked,H()}).appendTo(T);new $("label").attr({for:"she"}).text("Show 'Edit' button next to messages").appendTo(T);const _=new $("span"),q=new $("span").appendTo(_).class("pb-0").classOn("row"),Q4=new $("input").attr({id:"tem",type:"checkbox",checked:U.testMode===!0?!0:void 0}).on("input",(E)=>{U.testMode=E.target.checked,H()}).appendTo(q);new $("label").attr({for:"tem"}).text("Enable Test Mode (fake responses for debugging)").appendTo(q);const u=new $("select").appendMany(new $("option").text("Dark").attr({value:"dark",selected:U.theme==="dark"?!0:void 0}),new $("option").text("Light").attr({value:"light",selected:U.theme==="light"?!0:void 0}),new $("option").text("Midnight").attr({value:"amoled",selected:U.theme==="amoled"?!0:void 0}),new $("option").text("Lavender").attr({value:"lavender",selected:U.theme==="lavender"?!0:void 0}),new $("option").text("Maroon").attr({value:"maroon",selected:U.theme==="maroon"?!0:void 0}),new $("option").text("Tangerine").attr({value:"tangerine",selected:U.theme==="tangerine"?!0:void 0}),new $("option").text("Lemon").attr({value:"lemon",selected:U.theme==="lemon"?!0:void 0}),new $("option").text("Forest").attr({value:"forest",selected:U.theme==="forest"?!0:void 0}),new $("option").text("Azure").attr({value:"azure",selected:U.theme==="azure"?!0:void 0}),new $("option").text("Orchid").attr({value:"orchid",selected:U.theme==="orchid"?!0:void 0}),new $("option").text("Violet").attr({value:"violet",selected:U.theme==="violet"?!0:void 0})).on("input",(E)=>{document.documentElement.dataset.theme=E.target.value,U.theme=E.target.value,H()}),j=new $("select").appendMany(new $("option").text("Cozy (default)").attr({value:"cozy",selected:U.chatViewType==="cozy"?!0:void 0}),new $("option").text("Compact").attr({value:"compact",selected:U.chatViewType==="compact"?!0:void 0}),new $("option").text("Bubbles").attr({value:"bubbles",selected:U.chatViewType==="bubbles"?!0:void 0}),new $("option").text("Flat Bubbles").attr({value:"flat-bubbles",selected:U.chatViewType==="flat-bubbles"?!0:void 0})).on("input",(E)=>{document.documentElement.dataset.chatViewType=E.target.value,U.chatViewType=E.target.value,H()}),v=new $("span").appendTo(_).classOn("row");function I(){if(!i.elm.checked)A.elm.disabled=!0;else A.elm.disabled=!1}const i=new $("input").attr({id:"epp",type:"checkbox",checked:U.promptPrefixEnabled===!0?!0:void 0}).on("input",(E)=>{U.promptPrefixEnabled=E.target.checked,I(),H()}).appendTo(v);new $("label").attr({for:"epp"}).text("Enable prompt prefix").appendTo(v);const A=new $("textarea").attr({rows:4,placeholder:"<none>",resize:"none"}).html(U.promptPrefix!==!1?U.promptPrefix:"").on("input",(E)=>{U.promptPrefix=E.target.value.length>0?E.target.value:!1,H()});I();const y=new $("select").appendMany(new $("option").text("25").attr({value:"25",selected:U.ctxLength==="25"?!0:void 0}),new $("option").text("32").attr({value:"32",selected:U.ctxLength==="32"?!0:void 0}),new $("option").text("64").attr({value:"64",selected:U.ctxLength==="64"?!0:void 0}),new $("option").text("128").attr({value:"128",selected:U.ctxLength==="128"?!0:void 0}),new $("option").text("256").attr({value:"256",selected:U.ctxLength==="256"?!0:void 0}),new $("option").text("512").attr({value:"512",selected:U.ctxLength==="512"?!0:void 0}),new $("option").text("1024").attr({value:"1024",selected:U.ctxLength==="1024"?!0:void 0}),new $("option").text("2048").attr({value:"2048",selected:U.ctxLength==="2048"?!0:void 0}),new $("option").text("2500").attr({value:"2500",selected:U.ctxLength==="2500"?!0:void 0}),new $("option").text("2750").attr({value:"2750",selected:U.ctxLength==="2750"?!0:void 0}),new $("option").text("3072").attr({value:"3072",selected:U.ctxLength==="3072"?!0:void 0})).on("input",(E)=>{U.ctxLength=E.target.value,H()}),x=new $("select").appendMany(new $("option").text("25").attr({value:"25",selected:U.maxTokens==="25"?!0:void 0}),new $("option").text("32").attr({value:"32",selected:U.maxTokens==="32"?!0:void 0}),new $("option").text("64").attr({value:"64",selected:U.maxTokens==="64"?!0:void 0}),new $("option").text("128").attr({value:"128",selected:U.maxTokens==="128"?!0:void 0}),new $("option").text("256").attr({value:"256",selected:U.maxTokens==="256"?!0:void 0}),new $("option").text("512").attr({value:"512",selected:U.maxTokens==="512"?!0:void 0}),new $("option").text("1024").attr({value:"1024",selected:U.maxTokens==="1024"?!0:void 0}),new $("option").text("2048").attr({value:"2048",selected:U.maxTokens==="2048"?!0:void 0})).on("input",(E)=>{U.maxTokens=E.target.value,H()}),S=new $("div").classOn("col").appendMany(Z,new $("fieldset").appendMany(new $("legend").text("Personalization"),new $("span").classOn("pb-2","flex").text("Username"),V,K),new $("fieldset").appendMany(new $("legend").text("Appearance"),new $("span").classOn("pb-2","flex").text("Theme"),u,new $("span").classOn("pb-2","pt-2","flex").text("Chat Style"),j,w),new $("fieldset").appendMany(new $("legend").text("Chatbot Settings"),v,new $("span").classOn("pb-2","flex").text("Prompt prefix"),A,new $("span").classOn("pt-2","pb-2","flex").text("Context Length (in tokens)"),y,new $("span").classOn("pt-2","pb-2","flex").text("Max Tokens (to generate)"),x,new $("span").classOn("pt-2","flex").text("Test Mode"),_)),g=new B(S);g.show()})}function H4(J){const Z=new $().classOn("column").appendTo(J),Q=new $("span").text("Please wait..").appendTo(Z),D=new $("div").classOn("meter").attr({value:0,max:100}).append(new $().style({width:"0%"})).appendTo(Z),V=new $("span").classOn("small-text").text("..").appendTo(Z);Y.set("requestUi_wrapper",Z),Y.set("requestUi_text",Q),Y.set("requestUi_meter",D),Y.set("requestUi_hint",V)}async function w1(J){const Z=await fetch("/api/version").then((V)=>V.json());document.title=`Chatify ${Z.version}`;const Q=new $("a").text("See Changelogs").on("click",(V)=>{let K=new $().html(Z.changelog);new B(K).show()}),D=new $("span").classOn("small-label").style({"margin-top":"auto"}).html(Z.footerNote).append(Q).appendTo(J);Y.set("debugVersionNumber",D)}function v4(J){const Z=new $("button").html(k.chevron).class("fg-auto","flip-off").appendTo(J);Z.on("click",()=>{if(Y.get("menuState")===!0)Y.set("menuState",!1),Z.classOff("flip-off"),Z.classOn("flip"),customSettingsWrapper.classOn("extra-hidden"),convoManageButton.classOn("extra-hidden"),userSettingsBtn.classOn("extra-hidden"),requestUi_wrapper.classOn("extra-hidden"),heading.classOff("extra-hidden"),multiRow.classOn("extra-hidden"),deleteConvoButton.classOn("extra-hidden"),Z.style({"margin-left":"auto"}),Y.get("selectPromptBtn").classOn("extra-hidden"),Y.get("debugVersionNumber").classOn("extra-hidden"),Y.get("sideBar").classOn("mw-0");else if(Y.get("menuState")===!1)Y.set("menuState",!0),Z.classOff("flip"),Z.classOn("flip-off"),multiRow.classOff("extra-hidden"),customSettingsWrapper.classOff("extra-hidden"),convoManageButton.classOff("extra-hidden"),userSettingsBtn.classOff("extra-hidden"),requestUi_wrapper.classOff("extra-hidden"),heading.classOn("extra-hidden"),deleteConvoButton.classOff("extra-hidden"),Z.style({"margin-left":"unset"}),Y.get("selectPromptBtn").classOff("extra-hidden"),Y.get("debugVersionNumber").classOff("extra-hidden"),Y.get("sideBar").classOff("mw-0")})}function M4(J){Y.set("aiNameOverride",!1),Y.set("aiAvatarOverride",!1);const Z=new $().class("column","pb-2","pt-0","hidden").appendTo(J);Y.set("customSettingsWrapper",Z),console.log(Y.get("customSettingsWrapper"));const Q=new $("textarea").appendTo(Z).attr({type:"text",placeholder:"System prompt",rows:"4"}),D=new $("input").appendTo(Z).attr({type:"text",placeholder:"Bot Name Override"}).on("input",(O)=>{if(Y.set("aiNameOverride",O.target.value),Y.get("aiNameOverride")=="")Y.set("aiNameOverride",!1)}),V=new $("input").appendTo(Z).attr({type:"text",placeholder:"Avatar Override, ex. https://...png"}).on("input",(O)=>{if(Y.set("aiAvatarOverride",O.target.value),Y.get("aiAvatarOverride")=="")Y.set("aiAvatarOverride",!1)});Y.set("customSettings_systemPrompt",Q),Y.set("customSettings_overrideName",D),Y.set("customSettings_overrideAvatar",V);const K=new $("span").classOn("row","py-0").appendTo(Z),X=new $("span").classOn("row","py-0").appendTo(Z);new $("button").text("Import").classOn("fg").appendTo(X).on("click",()=>{const O=new $("textarea").attr({rows:8,placeholder:"{ ... }"}),G=new $("div").text("Import JSON data:").append(new $().classOn("column").appendMany(O,new $("button").text("Attempt Import").classOn("fg-auto").on("click",(R)=>{t(O.elm.value,()=>{w.hide()})}))),w=new B(G);w.show()}),new $("button").text("Export").class("fg").appendTo(X).on("click",()=>{const O=new $("div").text("How do you want to export?").append(new $().classOn("row").appendMany(new $("button").text("JSON Export").classOn("fg-auto").on("click",(w)=>{G.hide();const R=new $("div").text("Here's your exported prompt:").append(new $("textarea").attr({rows:8}).html(JSON.stringify({system:Q.elm.value,temp:z.elm.value,avatar:Y.get("aiAvatarOverride"),name:Y.get("aiNameOverride")})));new B(R).show()}),new $("button").text("Add to Saved").classOn("fg-auto").on("click",(w)=>{G.hide();const R=a(),N=Y.get("aiNameOverride")||"prompt-"+Object.keys(R).length,F=x4(N);if(R[F])if(confirm(`Saving this prompt with the same name as "${F}" will forcefully overwrite it.\nAre you sure you want to do this?`)===!0)Y4(F,{system:Q.elm.value,temp:z.elm.value,avatar:Y.get("aiAvatarOverride"),name:N});else return;else Y4(F,{system:Q.elm.value,temp:z.elm.value,avatar:Y.get("aiAvatarOverride"),name:Y.get("aiNameOverride")});let P=new $("span").text("Saved! Open the prompt picker and go to Saved to see your creation.");new B(P).show()}))),G=new B(O);G.show()}),new $("label").attr({for:"temp"}).text("Temperature").appendTo(K);const z=new $("input").attr({id:"temp",type:"range",min:"0",max:"1",step:"0.01"}).appendTo(K);Y.set("customSettings_temp",z)}async function k4(){const J=new $().class("config").appendTo("body");Y.set("sideBar",J);const Z=new $().class("row").appendTo(J),Q=new $("span").text("Chatify").classOn("extra-hidden","label").appendTo(Z),D=new $("button").html(k.trashCan).classOn("center","danger","fg-auto").appendTo(Z).on("click",(w)=>clearMessageHistory());Y.set("deleteConvoButton",D);const V=new $("select").class("fg","extra-hidden").appendTo(Z);Y.set("select",V),(await y4()).forEach((w)=>{V.elm.appendChild(new Option(w.label,w.id))}),V.elm.append(new Option("Custom","custom"));const X=new $().class("fg").appendTo(Z);v4(Z),M4(J);const z=new $("button").text("Select prompt..").classOn("transparent","fg","w-100").appendTo(X).on("click",async()=>{await S4()});Y.set("selectPromptBtn",z);let O=localStorage.getItem("remembered-name")??"User";Y.set("userName",O);const G=new $().classOn("row").appendTo(J);W4(G),j4(G),H4(J),await w1(J),await e(),D4()}function G1(J="The conversation resumes."){new $().append(new $("span").classOn("text").text(J)).classOn("separator").appendTo(Y.get("messagesContainer")),m()}U4();Y.set("assistantObj",null);Y.set("loadedCustomPrompt",{});Y.set("lastScrollTop",-1);Y.set("lastScrollHeight",-1);Y.set("OPENAI_URL_WS",`${location.protocol.replace("http","ws")}//${location.host}/stream`);await k4();u4();Y.set("messageHistory",[]);Y.set("menuState",!0);G1("Your conversation begins here.");K4();